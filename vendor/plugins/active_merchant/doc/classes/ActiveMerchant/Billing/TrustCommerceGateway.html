<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ActiveMerchant::Billing::TrustCommerceGateway</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ActiveMerchant::Billing::TrustCommerceGateway</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/active_merchant/billing/gateways/trust_commerce_rb.html">
                lib/active_merchant/billing/gateways/trust_commerce.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Gateway.html">
                Gateway
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
TO USE: First, make sure you have everything setup correctly and all of
your dependencies in place with:
</p>
<pre>
  require 'rubygems'
  require 'active_merchant'
</pre>
<p>
ActiveMerchant expects amounts to be Integer values in cents
</p>
<pre>
  tendollar = 1000
</pre>
<p>
Next, create a <a href="TrustCommerceGateway.html#M000333">credit</a> card
object using a TC approved test card.
</p>
<pre>
  creditcard = ActiveMerchant::Billing::CreditCard.new(
      :number =&gt; '4111111111111111',
      :month =&gt; 8,
      :year =&gt; 2006,
      :first_name =&gt; 'Longbob',
    :last_name =&gt; 'Longsen'
  )
</pre>
<p>
To finish setting up, create the active_merchant object you will be using,
with the TrustCommerce gateway. If you have a functional TrustCommerce
account, replace login and password with your account info. Otherwise the
defaults will work for testing.
</p>
<pre>
  gateway = ActiveMerchant::Billing::Base.gateway(:trust_commerce).new(:login =&gt; &quot;TestMerchant&quot;, :password =&gt; &quot;password&quot;)
</pre>
<p>
Now we are ready to process our transaction
</p>
<pre>
  response = gateway.purchase(tendollar, creditcard)
</pre>
<p>
Sending a transaction to TrustCommerce with active_merchant returns a <a
href="Response.html">Response</a> object, which consistently allows you to:
</p>
<p>
1) <a href="Check.html">Check</a> whether the transaction was successful
</p>
<pre>
  response.success?
</pre>
<p>
2) Retrieve any message returned by TrustCommerce, either a
&quot;transaction was successful&quot; note or an explanation of why the
transaction was rejected.
</p>
<pre>
  response.message
</pre>
<p>
3) Retrieve and <a href="TrustCommerceGateway.html#M000336">store</a> the
unique transaction ID returned by Trust Commerece, for use in referencing
the transaction in the future.
</p>
<pre>
  response.params[&quot;transid&quot;]
</pre>
<p>
For higher performance and failover with the <a
href="TrustCommerceGateway.html">TrustCommerceGateway</a> you can install
the TCLink library from <a
href="http://www.trustcommerce.com/tclink.html">www.trustcommerce.com/tclink.html</a>.
Follow the instructions available there to get it working on your system.
ActiveMerchant will automatically use tclink if available.
</p>
<p>
The TCLink library has the following added benefits:
</p>
<pre>
 * Good transaction times. Transaction duration under 1.2 seconds are common.
 * Fail-over to geographically distributed servers for extreme reliability
</pre>
<p>
Once it is installed, you should be able to make sure that it is visible to
your ruby install by opening irb and typing &quot;require
&#8216;tclink&#8217;&quot;, which should return &quot;true&quot;.
</p>
<p>
This should be enough to get you started with Trust Commerce and
active_merchant. For further information, review the methods below and the
rest of active_merchant&#8216;s documentation, as well as Trust
Commerce&#8216;s user and developer documentation.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000330">authorize</a>&nbsp;&nbsp;
      <a href="#M000332">capture</a>&nbsp;&nbsp;
      <a href="#M000333">credit</a>&nbsp;&nbsp;
      <a href="#M000327">new</a>&nbsp;&nbsp;
      <a href="#M000331">purchase</a>&nbsp;&nbsp;
      <a href="#M000335">recurring</a>&nbsp;&nbsp;
      <a href="#M000336">store</a>&nbsp;&nbsp;
      <a href="#M000326">tclink?</a>&nbsp;&nbsp;
      <a href="#M000328">tclink?</a>&nbsp;&nbsp;
      <a href="#M000329">test?</a>&nbsp;&nbsp;
      <a href="#M000337">unstore</a>&nbsp;&nbsp;
      <a href="#M000334">void</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">URL</td>
          <td>=</td>
          <td class="context-item-value">'https://vault.trustcommerce.com/trans/'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SUCCESS_TYPES</td>
          <td>=</td>
          <td class="context-item-value">[&quot;approved&quot;, &quot;accepted&quot;]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DECLINE_CODES</td>
          <td>=</td>
          <td class="context-item-value">{         &quot;decline&quot;       =&gt; &quot;The credit card was declined&quot;,         &quot;avs&quot;           =&gt; &quot;AVS failed; the address entered does not match the billing address on file at the bank&quot;,         &quot;cvv&quot;           =&gt; &quot;CVV failed; the number provided is not the correct verification number for the card&quot;,         &quot;call&quot;          =&gt; &quot;The card must be authorized manually over the phone&quot;,         &quot;expiredcard&quot;   =&gt; &quot;Issuer was not certified for card verification&quot;,         &quot;carderror&quot;     =&gt; &quot;Card number is invalid&quot;,         &quot;authexpired&quot;   =&gt; &quot;Attempt to postauth an expired (more than 14 days old) preauth&quot;,         &quot;fraud&quot;         =&gt; &quot;CrediGuard fraud score was below requested threshold&quot;,         &quot;blacklist&quot;     =&gt; &quot;CrediGuard blacklist value was triggered&quot;,          &quot;velocity&quot;      =&gt; &quot;CrediGuard velocity control value was triggered&quot;,         &quot;dailylimit&quot;    =&gt; &quot;Daily limit in transaction count or amount as been reached&quot;,         &quot;weeklylimit&quot;   =&gt; &quot;Weekly limit in transaction count or amount as been reached&quot;,         &quot;monthlylimit&quot;  =&gt; &quot;Monthly limit in transaction count or amount as been reached&quot;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BADDATA_CODES</td>
          <td>=</td>
          <td class="context-item-value">{         &quot;missingfields&quot;       =&gt; &quot;One or more parameters required for this transaction type were not sent&quot;,         &quot;extrafields&quot;         =&gt; &quot;Parameters not allowed for this transaction type were sent&quot;,         &quot;badformat&quot;           =&gt; &quot;A field was improperly formatted, such as non-digit characters in a number field&quot;,         &quot;badlength&quot;           =&gt; &quot;A field was longer or shorter than the server allows&quot;,         &quot;merchantcantaccept&quot;  =&gt; &quot;The merchant can't accept data passed in this field&quot;,         &quot;mismatch&quot;            =&gt; &quot;Data in one of the offending fields did not cross-check with the other offending field&quot;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ERROR_CODES</td>
          <td>=</td>
          <td class="context-item-value">{         &quot;cantconnect&quot;   =&gt; &quot;Couldn't connect to the TrustCommerce gateway&quot;,         &quot;dnsfailure&quot;    =&gt; &quot;The TCLink software was unable to resolve DNS hostnames&quot;,         &quot;linkfailure&quot;   =&gt; &quot;The connection was established, but was severed before the transaction could complete&quot;,         &quot;failtoprocess&quot; =&gt; &quot;The bank servers are offline and unable to authorize transactions&quot;</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000327" class="method-detail">
        <a name="M000327"></a>

        <div class="method-heading">
          <a href="#M000327" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="TrustCommerceGateway.html#M000327">new</a> <a
href="TrustCommerceGateway.html">TrustCommerceGateway</a>
</p>
<p>
The gateway requires that a valid login and password be passed in the
<tt>options</tt> hash.
</p>
<h4>Options</h4>
<ul>
<li><tt>:login</tt> &#8212; The TrustCommerce account login.

</li>
<li><tt>:password</tt> &#8212; The TrustCommerce account password.

</li>
<li><tt>:test =&gt; true or false</tt> &#8212; Perform test transactions

</li>
</ul>
<h4>Test Account Credentials</h4>
<ul>
<li><tt>:login</tt> &#8212; TestMerchant

</li>
<li><tt>:password</tt> &#8212; password

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000327-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000327-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 128</span>
128:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span> = {})
129:         <span class="ruby-identifier">requires!</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">:login</span>, <span class="ruby-identifier">:password</span>)
130:       
131:         <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
132:         <span class="ruby-keyword kw">super</span>
133:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000326" class="method-detail">
        <a name="M000326"></a>

        <div class="method-heading">
          <a href="#M000326" class="method-signature">
          <span class="method-name">tclink?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000326-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000326-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 110</span>
110:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tclink?</span>
111:         <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">TCLink</span>)
112:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000330" class="method-detail">
        <a name="M000330"></a>

        <div class="method-heading">
          <a href="#M000330" class="method-signature">
          <span class="method-name">authorize</span><span class="method-args">(money, creditcard_or_billing_id, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000330">authorize</a>() is the first
half of the preauth(<a
href="TrustCommerceGateway.html#M000330">authorize</a>)/postauth(<a
href="TrustCommerceGateway.html#M000332">capture</a>) model. The TC API
docs call this preauth, we preserve active_merchant&#8216;s nomenclature of
<a href="TrustCommerceGateway.html#M000330">authorize</a>() for consistency
with the rest of the library. This method simply checks to make sure funds
are available for a transaction, and returns a transid that can be used
later to postauthorize (<a
href="TrustCommerceGateway.html#M000332">capture</a>) the funds.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000330-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000330-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 148</span>
148:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">authorize</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">creditcard_or_billing_id</span>, <span class="ruby-identifier">options</span> = {})
149:         <span class="ruby-identifier">parameters</span> = {
150:           <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
151:         }                                                             
152:         
153:         <span class="ruby-identifier">add_order_id</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
154:         <span class="ruby-identifier">add_customer_data</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
155:         <span class="ruby-identifier">add_payment_source</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">creditcard_or_billing_id</span>)
156:         <span class="ruby-identifier">add_addresses</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
157:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'preauth'</span>, <span class="ruby-identifier">parameters</span>)
158:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000332" class="method-detail">
        <a name="M000332"></a>

        <div class="method-heading">
          <a href="#M000332" class="method-signature">
          <span class="method-name">capture</span><span class="method-args">(money, authorization, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000332">capture</a>() is the second
half of the preauth(<a
href="TrustCommerceGateway.html#M000330">authorize</a>)/postauth(<a
href="TrustCommerceGateway.html#M000332">capture</a>) model. The TC API
docs call this postauth, we preserve active_merchant&#8216;s nomenclature
of <a href="TrustCommerceGateway.html#M000332">capture</a>() for
consistency with the rest of the library. To process a postauthorization
with TC, you need an amount in cents or a money object, and a TC transid.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000332-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000332-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 177</span>
177:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">capture</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span> = {})
178:         <span class="ruby-identifier">parameters</span> = {
179:           <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
180:           <span class="ruby-identifier">:transid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">authorization</span>,
181:         }
182:                                                   
183:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'postauth'</span>, <span class="ruby-identifier">parameters</span>)
184:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000333" class="method-detail">
        <a name="M000333"></a>

        <div class="method-heading">
          <a href="#M000333" class="method-signature">
          <span class="method-name">credit</span><span class="method-args">(money, identification, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000333">credit</a>() allows you to
return money to a card that was previously billed. You need to supply the
amount, in cents or a money object, that you want to refund, and a TC
transid for the transaction that you are refunding.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000333-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000333-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 188</span>
188:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">credit</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">identification</span>, <span class="ruby-identifier">options</span> = {})  
189:         <span class="ruby-identifier">parameters</span> = {
190:           <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
191:           <span class="ruby-identifier">:transid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">identification</span>
192:         }
193:                                                   
194:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'credit'</span>, <span class="ruby-identifier">parameters</span>)
195:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000331" class="method-detail">
        <a name="M000331"></a>

        <div class="method-heading">
          <a href="#M000331" class="method-signature">
          <span class="method-name">purchase</span><span class="method-args">(money, creditcard_or_billing_id, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000331">purchase</a>() is a simple
sale. This is one of the most common types of transactions, and is
extremely simple. All that you need to process a <a
href="TrustCommerceGateway.html#M000331">purchase</a> are an amount in
cents or a money object and a creditcard object or billingid string.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000331-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000331-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 162</span>
162:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">purchase</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">creditcard_or_billing_id</span>, <span class="ruby-identifier">options</span> = {})        
163:         <span class="ruby-identifier">parameters</span> = {
164:           <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
165:         }                                                             
166:         
167:         <span class="ruby-identifier">add_order_id</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
168:         <span class="ruby-identifier">add_customer_data</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
169:         <span class="ruby-identifier">add_payment_source</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">creditcard_or_billing_id</span>)
170:         <span class="ruby-identifier">add_addresses</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
171:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'sale'</span>, <span class="ruby-identifier">parameters</span>)
172:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000335" class="method-detail">
        <a name="M000335"></a>

        <div class="method-heading">
          <a href="#M000335" class="method-signature">
          <span class="method-name">recurring</span><span class="method-args">(money, creditcard, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000335">recurring</a>() a TrustCommerce
account that is activated for Citatdel, TrustCommerce&#8216;s hosted
customer billing info database.
</p>
<p>
Recurring billing uses the same TC action as a plain-vanilla &#8216;<a
href="TrustCommerceGateway.html#M000336">store</a>&#8217;, but we have a
separate method for clarity. It can be called like <a
href="TrustCommerceGateway.html#M000336">store</a>, with the addition of a
required &#8216;periodicity&#8217; parameter:
</p>
<p>
The parameter :periodicity should be specified as either :bimonthly,
:monthly, :biweekly, :weekly, :yearly or :daily
</p>
<pre>
  gateway.recurring(tendollar, creditcard, :periodicity =&gt; :weekly)
</pre>
<p>
You can optionally specify how long you want payments to continue using
&#8216;payments&#8216;
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000335-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000335-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 230</span>
230:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recurring</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">creditcard</span>, <span class="ruby-identifier">options</span> = {})        
231:         <span class="ruby-identifier">requires!</span>(<span class="ruby-identifier">options</span>, [<span class="ruby-identifier">:periodicity</span>, <span class="ruby-identifier">:bimonthly</span>, <span class="ruby-identifier">:monthly</span>, <span class="ruby-identifier">:biweekly</span>, <span class="ruby-identifier">:weekly</span>, <span class="ruby-identifier">:yearly</span>, <span class="ruby-identifier">:daily</span>] )
232:       
233:         <span class="ruby-identifier">cycle</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:periodicity</span>]
234:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:monthly</span>
235:           <span class="ruby-value str">'1m'</span>
236:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:bimonthly</span>
237:           <span class="ruby-value str">'2m'</span>
238:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:weekly</span>
239:           <span class="ruby-value str">'1w'</span>
240:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:biweekly</span>
241:           <span class="ruby-value str">'2w'</span>
242:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:yearly</span>
243:           <span class="ruby-value str">'1y'</span>
244:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:daily</span>
245:           <span class="ruby-value str">'1d'</span>
246:         <span class="ruby-keyword kw">end</span>
247:         
248:         <span class="ruby-identifier">parameters</span> = {
249:           <span class="ruby-identifier">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
250:           <span class="ruby-identifier">:cycle</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cycle</span>,
251:           <span class="ruby-identifier">:verify</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verify</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'y'</span>,
252:           <span class="ruby-identifier">:billingid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:billingid</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">nil</span>,
253:           <span class="ruby-identifier">:payments</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:payments</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">nil</span>,
254:         }
255:         
256:         <span class="ruby-identifier">add_creditcard</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">creditcard</span>)
257:                                                   
258:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'store'</span>, <span class="ruby-identifier">parameters</span>)
259:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000336" class="method-detail">
        <a name="M000336"></a>

        <div class="method-heading">
          <a href="#M000336" class="method-signature">
          <span class="method-name">store</span><span class="method-args">(creditcard, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000336">store</a>() requires a
TrustCommerce account that is activated for Citatdel. You can call it with
a <a href="TrustCommerceGateway.html#M000333">credit</a> card and a billing
ID you would like to use to reference the stored <a
href="TrustCommerceGateway.html#M000333">credit</a> card info for future
captures. Use &#8216;verify&#8217; to specify whether you want to simply <a
href="TrustCommerceGateway.html#M000336">store</a> the card in the DB, or
you want TC to verify the data first.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000336-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000336-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 265</span>
265:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">store</span>(<span class="ruby-identifier">creditcard</span>, <span class="ruby-identifier">options</span> = {})   
266:         <span class="ruby-identifier">parameters</span> = {
267:           <span class="ruby-identifier">:verify</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verify</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'y'</span>,
268:           <span class="ruby-identifier">:billingid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:billingid</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">nil</span>,
269:         }
270:         
271:         <span class="ruby-identifier">add_creditcard</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">creditcard</span>)
272:         <span class="ruby-identifier">add_addresses</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)                              
273:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'store'</span>, <span class="ruby-identifier">parameters</span>)
274:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000328" class="method-detail">
        <a name="M000328"></a>

        <div class="method-heading">
          <a href="#M000328" class="method-signature">
          <span class="method-name">tclink?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000328-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000328-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 135</span>
135:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tclink?</span>
136:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">tclink?</span>
137:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000329" class="method-detail">
        <a name="M000329"></a>

        <div class="method-heading">
          <a href="#M000329" class="method-signature">
          <span class="method-name">test?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000329-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000329-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 139</span>
139:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test?</span>
140:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:test</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">super</span>
141:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000337" class="method-detail">
        <a name="M000337"></a>

        <div class="method-heading">
          <a href="#M000337" class="method-signature">
          <span class="method-name">unstore</span><span class="method-args">(identification, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
To <a href="TrustCommerceGateway.html#M000337">unstore</a> a creditcard
stored in Citadel using <a
href="TrustCommerceGateway.html#M000336">store</a>() or <a
href="TrustCommerceGateway.html#M000335">recurring</a>(), all that is
required is the billing id. When you run <a
href="TrustCommerceGateway.html#M000337">unstore</a>() the information will
be removed and a <a href="Response.html">Response</a> object will be
returned indicating the success of the action.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000337-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000337-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 278</span>
278:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unstore</span>(<span class="ruby-identifier">identification</span>, <span class="ruby-identifier">options</span> = {})
279:         <span class="ruby-identifier">parameters</span> = {
280:           <span class="ruby-identifier">:billingid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">identification</span>,
281:         }
282:                                                   
283:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'unstore'</span>, <span class="ruby-identifier">parameters</span>)
284:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000334" class="method-detail">
        <a name="M000334"></a>

        <div class="method-heading">
          <a href="#M000334" class="method-signature">
          <span class="method-name">void</span><span class="method-args">(authorization, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="TrustCommerceGateway.html#M000334">void</a>() clears an existing
authorization and releases the reserved fund s back to the cardholder. The
TC API refers to this transaction as a reversal. After voiding, you will no
longer be able to <a href="TrustCommerceGateway.html#M000332">capture</a>
funds from this authorization. TrustCommerce seems to always return a
status of &quot;accepted&quot; even if the transid you are trying to
deauthorize has already been captured. Note: Your account needs to be
configured by TrustCommerce to allow for reversal transactions before you
can use this method.
</p>
<p>
NOTE: AMEX preauth&#8216;s cannot be reversed. If you want to clear it more
quickly than the automatic expiration (7-10 days), you will have to <a
href="TrustCommerceGateway.html#M000332">capture</a> it and then
immediately issue a <a href="TrustCommerceGateway.html#M000333">credit</a>
for the same amount which should clear the customers <a
href="TrustCommerceGateway.html#M000333">credit</a> card with 48 hours
according to TC.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000334-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000334-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_merchant/billing/gateways/trust_commerce.rb, line 211</span>
211:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">void</span>(<span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span> = {})
212:         <span class="ruby-identifier">parameters</span> = {
213:           <span class="ruby-identifier">:transid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">authorization</span>,
214:         }
215:         
216:         <span class="ruby-identifier">commit</span>(<span class="ruby-value str">'reversal'</span>, <span class="ruby-identifier">parameters</span>)
217:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>